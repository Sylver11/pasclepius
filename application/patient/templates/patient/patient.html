{% block content %}

<h4>Create new invoice</h4>
<form method=post autocomplete="off" id="newInvoice_mva" name="mva" class="mva" style="display:none">  
        {% for field, errors in form_mva.errors.items() %}
        <div class="alert alert-error">
            {{ form_mva[field].label }}: {{ ', '.join(errors) }}
        </div>
        {% endfor %}  
        <div class="form-row">
            {{ form_mva.hidden_tag() }}
            {{ form_mva.medical_aid(value='mva', style='display:none') }}
            
            <div class="form-group col-md-4">
                {{ form_mva.patient_name.label(class="required",  for="patient_name") }} {{ form_mva.patient_name(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.case_number.label(class="required",  for="case_number") }} {{ form_mva.case_number(class_="form-control") }}
            </div>
        </div>  
        <div class="form-row">
            
            <div class="form-group col-md-4">
                {{ form_mva.tariff.label(class="required", id="tariff_label", class="tariff_label") }} {{ form_mva.tariff(class_="tariff form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.po_number.label(class="required", id="po_label") }} {{ form_mva.po_number(class_="form-control") }}
            </div>
        </div>

        {% if 4 <= layout_code <= 9 %}
            <div class="form-row hospital_mva">
                <div class="form-group col-md-4">
                    {{ form_mva.hospital_name.label(id="hospital_name_label") }} {{ form_mva.hospital_name(class_="form-control") }}
                </div>
                <div class="form-group col-md-4">
                    {{ form_mva.admission_date.label(id="admission_date_label") }} {{ form_mva.admission_date(class_="form-control") }}
                </div>
                <div class="form-group col-md-4">
                    {{ form_mva.discharge_date.label(id="discharge_date_label") }} {{ form_mva.discharge_date(class_="form-control") }}
                </div>
            </div>
            {% endif %}
            {% if 7 <= layout_code <= 12 %}
            <div class="form-row procedure_other">
                <div class="form-group col-md-8">
                    {{ form_mva.diagnosis.label(id="diagnosis_label") }} {{ form_mva.diagnosis(class_="form-control") }}
                </div>
                <div class="form-group col-md-4">
                    {{ form_mva.diagnosis_date.label(id="diagnosis_date_label") }} {{ form_mva.diagnosis_date(class_="form-control") }}
                </div>
            </div>
            <div class="form-row procedure_other">
                <div class="form-group col-md-8">
                    {{ form_mva.procedure.label(id="procedure_label") }} {{ form_mva.procedure(class_="form-control") }}
                </div>
                <div class="form-group col-md-4">
                    {{ form_mva.procedure_date.label(id="procedure_date_label") }} {{ form_mva.procedure_date(class_="form-control") }}
                </div>
            </div>
            <div class="form-row procedure_other">
                <div class="form-group col-md-4">
                    {{ form_mva.implants.label(id="implants_label") }} {{ form_mva.implants(class_="form-control") }}
                </div>
                <div class="form-group col-md-4">
                    {{ form_mva.intra_op.label(id="intra_op_label") }} {{ form_mva.intra_op(class_="form-control") }}
                </div>
                <div class="form-group col-md-4">
                    {{ form_mva.post_op.label(id="post_op_label") }} {{ form_mva.post_op(class_="form-control") }}
                </div>
            </div>
        {% endif %}

            <br>
        {{ form_mva.submit(class_="btn btn-success") }}
    </form>  
    <form  method=post autocomplete="off" id="newInvoice_other" class="other" name="other" style="display:none">  
        {% for field, errors in form_other.errors.items() %}
        <div class="alert alert-error">
            {{ form_other[field].label }}: {{ ', '.join(errors) }}
        </div>
        {% endfor %}
        {{ form_other.hidden_tag() }}
        <div class="form-row">
            <div class="form-group col-md-4">
                {{form_other.medical_aid.label(class="required")}}  {{ form_other.medical_aid(class_="form-control other_medical_aid") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_other.tariff.label(class="required", id="tariff_label", class="tariff_label") }} {{ form_other.tariff(class_="tariff") }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_other.patient_name.label(class="required") }} {{ form_other.patient_name(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_other.main_member.label(class="required") }} {{ form_other.main_member(class_="form-control") }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_other.patient_birth_date.label(class="required") }} {{ form_other.patient_birth_date(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_other.medical_number.label(class="required") }} {{ form_other.medical_number(class_="form-control") }}
            </div>
        </div>
        {% if 4 <= layout_code <= 9 %}
<div class="form-row hospital_other">
    <div class="form-group col-md-4">
        {{ form_other.hospital_name.label(id="hospital_name_label") }} {{ form_mva.hospital_name(class_="form-control") }}
    </div>
    <div class="form-group col-md-4">
        {{ form_other.admission_date.label(id="admission_date_label") }} {{ form_mva.admission_date(class_="form-control") }}
    </div>
    <div class="form-group col-md-4">
        {{ form_other.discharge_date.label(id="discharge_date_label") }} {{ form_mva.discharge_date(class_="form-control") }}
    </div>
</div>
{% endif %}
{% if 7 <= layout_code <= 12 %}
<div class="form-row procedure_other">
    <div class="form-group col-md-8">
        {{ form_other.diagnosis.label(id="diagnosis_label") }} {{ form_mva.diagnosis(class_="form-control") }}
    </div>
    <div class="form-group col-md-4">
        {{ form_other.diagnosis_date.label(id="diagnosis_date_label") }} {{ form_mva.diagnosis_date(class_="form-control") }}
    </div>
</div>
<div class="form-row procedure_other">
    <div class="form-group col-md-8">
        {{ form_other.procedure.label(id="procedure_label") }} {{ form_mva.procedure(class_="form-control") }}
    </div>
    <div class="form-group col-md-4">
        {{ form_other.procedure_date.label(id="procedure_date_label") }} {{ form_mva.procedure_date(class_="form-control") }}
    </div>
</div>
<div class="form-row procedure_other">
    <div class="form-group col-md-4">
        {{ form_other.implants.label(id="implants_label") }} {{ form_mva.implants(class_="form-control") }}
    </div>
    <div class="form-group col-md-4">
        {{ form_other.intra_op.label(id="intra_op_label") }} {{ form_mva.intra_op(class_="form-control") }}
    </div>
    <div class="form-group col-md-4">
        {{ form_other.post_op.label(id="post_op_label") }} {{ form_mva.post_op(class_="form-control") }}
    </div>
</div>
{% endif %}
<br>

    {{ form_other.submit(class_="btn btn-success") }}
</form>  
       

 
  
    <h4>Past invoice</h4>  
    <!-- <ul class="list-group">

        <ul class="list-group-item" id="treatment-list- style="display:none;">
                <script>
                    $.getJSON('/get-invoice-items', {
                        invoice_id: "somethon",
                        uuid: "spmt",
                    }, function(invoice_items) {
                        
                        for (i = 0; i < invoice_items.length; i++) {
                            var node = document.createElement("li");
                            node.classList.add('list-group-item');
                            node.innerText = invoice_items[i]['description'];
                            el.appendChild(node);
                        }
                        var button = document.createElement("button");
                        button.innerHTML = "Continue Invoice";
                      
                        el.appendChild(button);
                        $('.continue').click(function(){
                            $.ajax({
                                url: '/set-known-invoice',
                                data: {invoice_items:  JSON.stringify(invoice_items)},
                                success: function() {
                                    window.location.href = "/patient/"
                                },
                            });
                         
                        })
                        
                    });
            </script>
        </ul> -->

    <!-- </ul>   -->
<!-- </div> -->


<script>


$(document).ready(function() {

        // $('.invoice_list').click(function() {
        //     $(this).next().css("display", "block");
        // });
   

    // $('.other').children('#date_other').datepicker({dateFormat: 'dd.mm.yy'})
    // $('.mva').children('#date_mva').datepicker({dateFormat: 'dd.mm.yy'})
    $('#procedure_date').datepicker({dateFormat: 'yy-mm-dd'})
    $('#diagnosis_date').datepicker({dateFormat: 'yy-mm-dd'})
    $('#admission_date').datepicker({dateFormat: 'yy-mm-dd'})
    $('#discharge_date').datepicker({dateFormat: 'yy-mm-dd'})
    // $(document).on('change', '.medical_aid',function() {
        // var selection = $(this).val()
        if(request_args["medical_aid"] == 'mva'){
            $('.other').css("display","none")
            $('.mva').css("display","block")

        }
        else{
            // $('.other_medical_aid').val('')
            $('.mva').css("display","none")
            $('.other').css("display","block")
        }
        // else{
        //     $('.other_medical_aid').val(selection)
        //     $('.mva').css("display","none")
        //     $('.other').css("display","block")
        // }
    // })

    
    
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", "{{ form_mva.csrf_token._value() }}")
            }
        }
    })


    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", "{{ form_other.csrf_token._value() }}")
            }
        }
    })
});

</script>
<script src="{{url_for('.static', filename='patient_bp/js/mva_submit.js')}}"></script>
<script src="{{url_for('.static', filename='patient_bp/js/other_submit.js')}}"></script>

 {% endblock %}