{% extends 'layout.html' %}
{% block content %}
<div class="container"> 
    <br>
    <br>
    <h3>Create new patient</h3> 
    <select class="medical custom-select w-25">
        <option value="0">Select medical aid</option>
        <option value="psemas">PSEMAS</option>
        <option value="mva">MVA</option>
        <option value="other">OTHER</option>
    </select>
    <br>
    <br>
    <form method=post autocomplete="off" id="newInvoice_mva" name="mva" class="mva" style="display:none">  
        {% for field, errors in form_mva.errors.items() %}
        <div class="alert alert-error">
            {{ form_mva[field].label }}: {{ ', '.join(errors) }}
        </div>
        {% endfor %}  
        <div class="form-row">
            {{ form_mva.hidden_tag() }}
            {{ form_mva.medical(value='mva', style='display:none') }}
            <div class="form-group col-md-4">
                {{ form_mva.tariff.label(class="required") }} {{ form_mva.tariff(class_="tariff form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.name.label(class="required",  for="name") }} {{ form_mva.name(class_="form-control") }}
            </div>
        </div>  
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_mva.case.label(class="required",  for="case") }} {{ form_mva.case(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.po.label(class="required") }} {{ form_mva.po(class_="form-control") }}
            </div>
        </div>
        {% if 4 <= layout_code <= 9 %}
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_mva.hospital.label }} {{ form_mva.hospital(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.admission.label }} {{ form_mva.admission(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.discharge.label }} {{ form_mva.discharge(class_="form-control") }}
            </div>
        </div>
        {% endif %}
        {% if 7 <= layout_code <= 12 %}
        <div class="form-row">
            <div class="form-group col-md-8">
                {{ form_mva.diagnosis.label }} {{ form_mva.diagnosis(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.diagnosis_date.label }} {{ form_mva.diagnosis_date(class_="form-control") }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-8">
                {{ form_mva.procedure.label }} {{ form_mva.procedure(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.procedure_date.label }} {{ form_mva.procedure_date(class_="form-control") }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_mva.implants.label }} {{ form_mva.implants(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.intra_op.label }} {{ form_mva.intra_op(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.post_op.label }} {{ form_mva.post_op(class_="form-control") }}
            </div>
        </div>
        {% endif %}
        {{ form_mva.date_created.label(class="required") }} {{ form_mva.date_created(id='date_mva', class_="form-control w-25 p-3") }}
        <br>
        {{ form_mva.submit(class_="btn btn-success") }}
    </form>  
    <form method=post autocomplete="off" id="newInvoice_psemas" class="psemas" name="psemas" style="display:none"> 
        {% for field, errors in form_psemas.errors.items() %}
        <div class="alert alert-error">
            {{ form_psemas[field].label }}: {{ ', '.join(errors) }}
        </div>
        {% endfor %}
        {{ form_psemas.hidden_tag() }}
        {{ form_psemas.medical(value='psemas', style='display:none') }}
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_psemas.tariff.label(class='required') }} {{ form_psemas.tariff(class_="tariff") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_psemas.name.label(class='required') }} {{ form_psemas.name(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_psemas.main.label(class='required') }} {{ form_psemas.main(class_="form-control") }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_psemas.dob.label(class='required') }} {{ form_psemas.dob(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_psemas.number.label(class='required') }} {{ form_psemas.number(class_="form-control") }}
            </div>
        </div>
       
        {% if 4 <= layout_code <= 9 %}
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_mva.hospital.label }} {{ form_mva.hospital(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.admission.label }} {{ form_mva.admission(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.discharge.label }} {{ form_mva.discharge(class_="form-control") }}
            </div>
        </div>
        {% endif %}
        {% if 7 <= layout_code <= 12 %}
        <div class="form-row">
            <div class="form-group col-md-8">
                {{ form_mva.diagnosis.label }} {{ form_mva.diagnosis(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.diagnosis_date.label }} {{ form_mva.diagnosis_date(class_="form-control") }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-8">
                {{ form_mva.procedure.label }} {{ form_mva.procedure(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.procedure_date.label }} {{ form_mva.procedure_date(class_="form-control") }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_mva.implants.label }} {{ form_mva.implants(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.intra_op.label }} {{ form_mva.intra_op(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.post_op.label }} {{ form_mva.post_op(class_="form-control") }}
            </div>
        </div>
        {% endif %}
        {{ form_psemas.date_created.label(class="required") }} {{ form_psemas.date_created(id='date_psemas', class_="form-control w-25 p-3") }}
        <br>
        {{ form_mva.submit(class_="btn btn-success") }}
    </form>  
    <form  method=post autocomplete="off" id="newInvoice_other" class="other" name="other" style="display:none">  
        {% for field, errors in form_other.errors.items() %}
        <div class="alert alert-error">
            {{ form_other[field].label }}: {{ ', '.join(errors) }}
        </div>
        {% endfor %}
        {{ form_other.hidden_tag() }}
        <div class="form-row">
            <div class="form-group col-md-4">
                {{form_other.medical.label(class="required")}}  {{ form_other.medical(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_other.tariff.label(class="required") }} {{ form_other.tariff(class_="tariff") }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_other.name.label(class="required") }} {{ form_other.name(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_other.main.label(class="required") }} {{ form_other.main(class_="form-control") }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_other.dob.label(class="required") }} {{ form_other.dob(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_other.number.label(class="required") }} {{ form_other.number(class_="form-control") }}
            </div>
        </div>
        {% if 4 <= layout_code <= 9 %}
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_mva.hospital.label }} {{ form_mva.hospital(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.admission.label }} {{ form_mva.admission(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.discharge.label }} {{ form_mva.discharge(class_="form-control") }}
            </div>
        </div>
        {% endif %}
        {% if 7 <= layout_code <= 12 %}
        <div class="form-row">
            <div class="form-group col-md-8">
                {{ form_mva.diagnosis.label }} {{ form_mva.diagnosis(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.diagnosis_date.label }} {{ form_mva.diagnosis_date(class_="form-control") }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-8">
                {{ form_mva.procedure.label }} {{ form_mva.procedure(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.procedure_date.label }} {{ form_mva.procedure_date(class_="form-control") }}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                {{ form_mva.implants.label }} {{ form_mva.implants(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.intra_op.label }} {{ form_mva.intra_op(class_="form-control") }}
            </div>
            <div class="form-group col-md-4">
                {{ form_mva.post_op.label }} {{ form_mva.post_op(class_="form-control") }}
            </div>
        </div>
        {% endif %}
        {{ form_other.date_created.label(class="required")  }} {{ form_other.date_created(id='date_other', class_="form-control w-25 p-3") }}
        <br>
        {{ form_other.submit(class_="btn btn-success") }}
    </form>  
</div>
<script>

    $(document).ready(function() {
        $('.other').children('#date_other').datepicker({dateFormat: 'dd.mm.yy'})
        $('.mva').children('#date_mva').datepicker({dateFormat: 'dd.mm.yy'})
        $('.psemas').children('#date_psemas').datepicker({dateFormat: 'dd.mm.yy'})
        $('#procedure_date').datepicker({dateFormat: 'dd.mm.yy'})
        $('#diagnosis_date').datepicker({dateFormat: 'dd.mm.yy'})
        $('#admission').datepicker({dateFormat: 'dd.mm.yy'})
        $('#discharge').datepicker({dateFormat: 'dd.mm.yy'})
        $(document).on('change', '.medical',function() {
            var selection = $(this).val()
            if(selection == 'psemas'){
                $('.mva').css("display","none")
                $('.other').css("display","none")
                $('.psemas').css("display","block")

            }else if(selection == 'mva'){
                $('.psemas').css("display","none")
                $('.other').css("display","none")
                $('.mva').css("display","block")

            }else{
                $('.psemas').css("display","none")
                $('.mva').css("display","none")
                $('.other').css("display","block")
            }
        })

        $('.psemas').submit(function (e) {
            var x = document.forms["psemas"]["tariff"].value;
            if (x == "") {
                e.preventDefault();
                alert("Tariff must be chosen.");
            }else{
            $(this).submit();
            } 

        });
        $('.other').submit(function (e) {
            var x = document.forms["other"]["tariff"].value;
            if (x == "") {
                e.preventDefault();
                alert("Tariff must be chosen.");
            }else{
            $(this).submit();
            } 

        });
        $('.mva').submit(function (e) {
            var x = document.forms["mva"]["tariff"].value;
            if (x == "") {
                e.preventDefault();
                alert("Tariff must be chosen.");
            }else{
            $(this).submit();
            } 

        });

        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ form_mva.csrf_token._value() }}")
                }
            }
        })
    });

</script>
 {% endblock %}